(function(d,c,a,e){var b=function(g,f){this._init()};b.prototype={constructor:b,_init:function(){d("#listar").bind("click",{scope:this},function(f){f.data.scope.listar()})},listar:function(){if(this.valida()){var i=d("#listar");i.toggleClass("active");var k=d("#nif_presentador").val();var j=d("#nif_empresa").val();var h=d("#proce option:selected").val();var l=d("#Estado option:selected").val();var f;if(l==""){f={nifPresentador:k,nifEmpresa:j,idProcedimiento:h}}else{f={nifPresentador:k,nifEmpresa:j,idProcedimiento:h,estado:l}}var g=this;d.ajax({url:localStorage.getItem(localStorage.getItem("entorno"))+"carga/v1/listar_cargas",type:"POST",dataType:"json",contentType:"application/json",success:function(m,n){console.log("listar ok");g.recorreRespuesta(m)},error:function(n,m){d.fn.error("Error en la peticion",n.responseText);i.toggleClass("active")},data:JSON.stringify(f),cache:false})}},valida:function(){if(d("#nif_empresa").val()==null||d("#nif_empresa").val()==""){d.fn.error("Introduzca el NIF de la empresa","")}else{d("#alertError").hide();return true}},recorreRespuesta:function(j){var t=this;var s=d("#cargas");d(".item-carga").remove();var l=j.length-1;for(l;l>=0;l--){var r=j[l];var o=a.createElement("tr");o.className="accordion-toggle";o.id="line-"+r.uuidCarga;var q=a.createElement("td");q.appendChild(t.createPlusButton(r));q.className="pl-toggle collapsed";q.setAttribute("data-toggle","collapse");q.setAttribute("data-target","#files-"+r.uuidCarga);o.appendChild(q);var h=a.createElement("td");h.id="num-"+r.uuidCarga;h.innerHTML=l+1;o.appendChild(h);var g=a.createElement("td");g.innerHTML=r.uuidCarga;o.appendChild(g);var v=a.createElement("td");v.innerHTML=r.fechaInicio?(new Date(r.fechaInicio+" UTC")).toLocaleString():"";o.appendChild(v);var u=a.createElement("td");u.innerHTML=r.fechaFinProceso?(new Date(r.fechaFinProceso+" UTC")).toLocaleString():"";o.appendChild(u);var p=a.createElement("td");p.appendChild(t.createButonEstado(r.estado,r.uuidCarga));var f=a.createElement("td");o.appendChild(p);if(r.estado=="INICIADA"){f.appendChild(t.createButonCancelar(r.uuidCarga))}o.appendChild(f);var n=a.createElement("td");n.appendChild(t.createFilestButton(r));n.setAttribute("data-toggle","collapse");n.setAttribute("data-target","#files-"+r.uuidCarga);o.appendChild(n);var k=a.createElement("tbody");k.className="item-carga";k.appendChild(o);k.appendChild(t.createTableFiles(r.ficheros,r.uuidCarga));s.append(k);d("#est-"+r.uuidCarga).click(function(){d.fn.consultaEstado(d(this),r.uuidCarga)});if(r.estado=="INICIADA"){d("#cancel-"+r.uuidCarga).click(function(){d.fn.cancelarCarga(d(this))})}}var m=d("#listar");m.toggleClass("active")},createButonCancelar:function(g){var f=a.createElement("a");f.className="cancelarCarga has-spinner enlace";f.id="cancel-"+g;f.setAttribute("data-uuid",g);var h=a.createElement("span");h.className="spinner fa fa-spinner fa-pulse";var i=a.createElement("span");i.innerText="Cancelar";f.appendChild(h);f.appendChild(i);return f},createButonEstado:function(j,g){var f=a.createElement("a");f.className="consultaEstado has-spinner enlace";f.id="est-"+g;f.setAttribute("data-uuid",g);var h=a.createElement("span");h.className="spinner fa fa-spinner fa-pulse";var i=a.createElement("span");i.id="est-text-"+g;i.innerText=j;f.appendChild(h);f.appendChild(i);return f},createFilestButton:function(h){var f=a.createElement("a");f.className="enlace";f.name="files-"+h.uuidCarga;f.id="fB-"+h.uuidCarga;var g=a.createElement("span");g.className="fa fa-ellipsis-v";var i=a.createElement("span");i.innerText=" Detalles";f.appendChild(i);return f},createPlusButton:function(i){var f=a.createElement("a");f.className="enlace";f.name="plus-"+i.uuidCarga;f.id="plus-"+i.uuidCarga;var h=a.createElement("i");h.className="fa fa-plus";var g=a.createElement("i");g.className="fa fa-minus";f.appendChild(h);f.appendChild(g);return f},createTableFiles:function(n,p){var j=a.createElement("td");j.className="hiddenRow";j.setAttribute("colspan","5");j.setAttribute("style","border-top: none !important;");var g=a.createElement("div");g.id="files-"+p;g.className="accordian-body collapse ";var q=a.createElement("table");q.className="table";var h=a.createElement("tr");var o=a.createElement("th");o.innerHTML="uuidUpload";var m=a.createElement("th");m.innerHTML="Nombre";var k=a.createElement("th");k.innerHTML="Tama√±o";var f=a.createElement("th");f.innerHTML="Estado";h.appendChild(o);h.appendChild(m);h.appendChild(k);h.appendChild(f);q.appendChild(h);d.each(n,function(r,w){if(w.nombre!=null&&w.nombre.indexOf(".err")<0){var x=a.createElement("tr");var u=a.createElement("td");u.innerHTML=w.uuidUpload;var t=a.createElement("td");t.innerHTML=w.nombre;var v=a.createElement("td");v.innerHTML=filesize(w.numeroBytes);var s=a.createElement("td");s.innerHTML=w.estado;x.appendChild(u);x.appendChild(t);x.appendChild(v);x.appendChild(s);q.appendChild(x)}});g.appendChild(q);j.appendChild(g);var i=a.createElement("td");i.setAttribute("style","border-top: none !important;");var l=a.createElement("tr");l.appendChild(i);l.appendChild(j);return l}};d.fn.cancelarCarga=function(f){f.toggleClass("active");var g=f[0].getAttribute("data-uuid");d.ajax({url:localStorage.getItem(localStorage.getItem("entorno"))+"carga/v1/cancelar_carga//"+g,type:"GET",success:function(h,i){console.log("carga cancelada");console.log(h);d("#est-text-"+g).text("CANCELADA");f.toggleClass("active");f.remove()},error:function(i,h){d.fn.error("Error en la peticion",i.responseText)}})};d.fn.listarCargas=function(g){var f=Array.apply(null,arguments);f.shift();return this.each(function(){var j=d(this),i=j.data("listarCargas"),h=typeof g==="object"&&g;if(!i){j.data("listarCargas",(i=new b(this,d.extend({},d.fn.listarCargas.defaults,h,d(this).data()))))}if(typeof g==="string"){i[g].apply(i,f)}})};d.fn.listarCargas.defaults={};d.fn.listarCargas.Constructor=b})(jQuery,window,document);