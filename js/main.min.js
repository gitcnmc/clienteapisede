var onLoadCert=true;var changeAuto=false;$(document).ready(function(){$("#uploader").uploaderFile({});$("#listarCargas").listarCargas({});$("#boxDescargas").listarDescargas({});toggleBoxes("uploader","Carga Express");var c=localStorage.getItem("info");if("oculto"==c){$("#alertInfo").remove()}var b=localStorage.getItem("preproduccion");if(b==null||b==undefined){localStorage.setItem("preproduccion","https://apipre.cnmc.gob.es/")}var d=localStorage.getItem("produccion");if(d==null||d==undefined){localStorage.setItem("produccion","https://api.cnmc.gob.es/")}var a=localStorage.getItem("entorno");if(location.href.indexOf("apipre.cnmc.gob.es")>-1){a="preproduccion"}if(location.href.indexOf("api.cnmc.gob.es")>-1){a="produccion"}if(a!=null&&a!=undefined){if(a=="preproduccion"){changeAuto=true;$("#Entorno").bootstrapToggle("on")}else{if(a=="produccion"){changeAuto=true;$("#Entorno").bootstrapToggle("off")}}}else{localStorage.setItem("entorno","produccion")}$("#divFoot").text(localStorage.getItem(localStorage.getItem("entorno")));checkCertificado();onLoadCert=false});$("#nif_empresa").change(function(){var b=$("#nif_empresa").val();var a=$("#nif_presentador").val();if(b==""||a==""){$("a[name*='play']").addClass("disabled")}else{$("a[name*='play']").removeClass("disabled")}});$("#nif_presentador").change(function(){var b=$("#nif_empresa").val();var a=$("#nif_presentador").val();if(b==""||a==""){$("a[name*='play']").addClass("disabled")}else{$("a[name*='play']").removeClass("disabled")}});$("#aCarga").click(function(){toggleBoxes("uploader",this.text.trim())});$("#aListarCargas").click(function(){toggleBoxes("listarCargas",this.text.trim())});$("#aDescargas").click(function(){toggleBoxes("descarga",this.text.trim())});$("#Entorno").change(function(){if(changeAuto){changeAuto=false}else{if(location.href.startsWith("https://api")&&location.href.indexOf("cnmc.gob.es")>-1){var b=$("#modalRedirect");var c=document.createElement("p");if($("#Entorno").prop("checked")){c.innerText="Le redirigimos a preproducci칩n"}else{c.innerText="Le redirigimos a producci칩n"}var a=$("#bodyRedirect");a.append(c);b.modal();return}}if($("#Entorno").prop("checked")){$("#footer").removeClass("navbar-red");$("#footer").addClass("navbar-green");localStorage.setItem("entorno","preproduccion")}else{$("#footer").removeClass("navbar-green");$("#footer").addClass("navbar-red");localStorage.setItem("entorno","produccion")}$("#divFoot").text(localStorage.getItem(localStorage.getItem("entorno")));if(!onLoadCert){checkCertificado()}else{onLoadCert=false}});$("#modalRedirect").on("hide.bs.modal",function(c){var b=localStorage.getItem("entorno");var a=$("#bodyRedirect");a.empty();if(b=="preproduccion"){changeAuto=true;$("#Entorno").bootstrapToggle("on")}else{if(b=="produccion"){changeAuto=true;$("#Entorno").bootstrapToggle("off")}}});$("#redirectAceptar").click(function(){var b=localStorage.getItem("entorno");var a="";if(b=="preproduccion"){a="https://api.cnmc.gob.es/cargador/"}else{if(b=="produccion"){a="https://apipre.cnmc.gob.es/cargador/"}}location.href=a});$("#ocultar").click(function(){$("#alertInfo").remove();localStorage.setItem("info","oculto")});function toggleBoxes(b,a){$("#alertError").hide();$("#formTitle").text(a);$(".caja").addClass("hidden");$("."+b).removeClass("hidden");$("."+b+" .btn.listar").click()}function checkCertificado(){$(".select2").select2({minimumResultsForSearch:Infinity});$("#nif_empresa").select2({tags:true,maximumSelectionSize:1});$.support.cors=true;$.ajax({url:localStorage.getItem(localStorage.getItem("entorno"))+"test/v1/nif",type:"GET",contentType:"application/json; charset=utf-8",xhrFields:{withCredentials:true},success:function(c,f){console.log("Nif OK");if(c!=""&&c!=undefined){console.log(c);$("#nif_presentador").val(c.nif);$("#nif_empresa").select2({data:c.empresa,tags:true,maximumSelectionSize:1})}else{var b=$("#modalEstado");$("#modal-title").text("ERROR");var a=$("#modal-body")[0];a.textContent="";var d=document.createElement("h2");d.innerText="El certificado utilizado no es v치lido";a.appendChild(d);b.modal("show")}},error:function(f,d){var b=$("#modalEstado");$("#modal-title").text("ERROR");var a=$("#modal-body")[0];a.textContent="";var c=document.createElement("h2");c.innerText="El certificado utilizado no es v치lido";a.appendChild(c);b.modal("show")},cache:false})};